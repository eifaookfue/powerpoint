レプリカとスレーブは同じ意味で使われていますか？マスターノードからデータを複製し、マスターが生きている限りは特に何もしないという認識で正しいですか

はい、**「レプリカ（Replica）」と「スレーブ（Slave）」**は、Redisにおいて基本的に同じ意味で使用されています。ただし、現在のRedisのドキュメントや設定では、**「レプリカ」**という用語が推奨されています。一方、「スレーブ」という用語は以前のバージョンや一部のドキュメントで使われていました。

---

## **1. レプリカ（スレーブ）ノードの役割**

### **基本的な役割**
1. **データの複製**:
   - レプリカノードは対応するマスターノードからデータを複製します。
   - **非同期複製**であるため、レプリカのデータはマスターと完全には一致しない場合がありますが、多くの場合は十分に近い状態を保ちます。

2. **フェイルオーバー時の昇格**:
   - マスターノードが障害を起こした場合、レプリカノードの1つが新しいマスターノードとして自動的に昇格します。
   - Redisクラスタでは、この昇格プロセスは他のノード間で合意が形成されて行われます。

3. **読み取り専用**:
   - レプリカノードはデフォルトでは読み取り専用です。
   - 一部のユースケースでは、**`replica-read-only no`**を設定することで、レプリカからの書き込みを許可することも可能ですが、通常は推奨されません。

---

### **マスターが生きている場合の動作**
あなたの認識は正しいです：
- マスターノードが正常に稼働している間、レプリカノードは基本的にデータの複製を行うだけで、**特に追加のアクションを実行しません**。
- 主な動作は次の通りです：
  - マスターノードからのデータ更新を非同期で受信し、ローカルに適用。
  - クライアントからの読み取りリクエストを処理（必要に応じて）。
  - フェイルオーバー時に備え、データの整合性を保つ。

---

## **2. 用語の違い**

### **「スレーブ」から「レプリカ」への変更**
Redisの開発者は、**「スレーブ（Slave）」という用語を「レプリカ（Replica）」に変更**しました。この変更は、言葉の多義性や誤解を避けるためのもので、機能自体に変更はありません。

- **スレーブ（Slave）**:
  - 以前のRedisバージョン（6.0以前）で主に使用されていた用語。
  - **`slaveof`**コマンドなどで設定されていました。
- **レプリカ（Replica）**:
  - Redis 5.0以降では「レプリカ」に用語が統一されました。
  - **`replicaof`**コマンドが新しい名前として導入されています。

---

## **3. フェイルオーバー時の動作**

### **フェイルオーバープロセス**
1. **マスターの障害検出**:
   - 他のノードがゴシッププロトコルによって、マスターが応答しないことを検出します。
2. **過半数の同意**:
   - 過半数のノードがマスターの障害に同意すると、フェイルオーバープロセスが開始。
3. **レプリカの昇格**:
   - 該当マスターに対応するレプリカノードの1つが新しいマスターとして昇格。
4. **再構成**:
   - 残りのレプリカノードが新しいマスターに再接続し、データの同期を開始。

### **昇格時の動作**
- 昇格されたレプリカノードは、以前のマスターとしての役割を引き継ぎ、新しいクライアントリクエストを処理します。
- Redisは、データの一貫性と信頼性を保つように設計されていますが、非同期レプリケーションの特性により、少量のデータ損失が発生する可能性があります。

---

## **4. レプリカの設定**

### **設定例**
以下は、`replicaof`を使った基本的な設定例です。

#### **マスターノード**
`redis-master.conf`:
```plaintext
port 6379
```

#### **レプリカノード**
`redis-replica.conf`:
```plaintext
port 6380
replicaof 127.0.0.1 6379
```

- マスターノードが6379ポートで稼働し、レプリカノードが6380ポートでデータを複製します。

---

## **5. まとめ**

- **レプリカとスレーブは同じ意味**で使われますが、現在は「レプリカ」という用語が推奨されています。
- **通常時の役割**:
  - レプリカノードはマスターノードのデータを非同期で複製し、特に他の処理は行いません（マスターが正常であれば）。
- **障害時の動作**:
  - マスターノードがダウンした場合、レプリカの1つが新しいマスターノードに昇格します。
- **現在の推奨設定**:
  - 用語変更に伴い、**`replicaof`**を使用して設定を行うことが推奨されます。

この設計により、Redisは高可用性とデータの信頼性を実現しています。